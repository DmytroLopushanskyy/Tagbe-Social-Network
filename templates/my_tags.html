{%extends 'header.html'%}
{%block center_part %}



<div class="col-xs-6 post_part m-t15">

    <div class="tag_page_header">
          <p class="tag_head">#–º–∞–π–±—É—Ç–Ω—î</p>
          <p class="tag_undertext">2 –ª—é–¥–µ–π –Ω–∞–ø–∏—Å–∞–ª–∏ –ø—Ä–æ —Ü–µ</p>
          <button class="tag_follow">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
    </div>
      <div class="tag_page_header">
          <p class="tag_head">üôÇloveit</p>
          <p class="tag_undertext">1 –ª—é–¥–µ–π –Ω–∞–ø–∏—Å–∞–ª–∏ –ø—Ä–æ —Ü–µ</p>
          <button class="tag_follow">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
    </div>
      <div class="tag_page_header">
          <p class="tag_head">üôÇnewava</p>
          <p class="tag_undertext">2 –ª—é–¥–µ–π –Ω–∞–ø–∏—Å–∞–ª–∏ –ø—Ä–æ —Ü–µ</p>
          <button class="tag_follow">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
    </div>
    <div class="tag_page_header">
          <p class="tag_head">#apple</p>
          <p class="tag_undertext">1 –ª—é–¥–µ–π –Ω–∞–ø–∏—Å–∞–ª–∏ –ø—Ä–æ —Ü–µ</p>
          <button class="tag_follow">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
    </div>
    <div class="tag_page_header">
          <p class="tag_head">üòØshotoniphone</p>
          <p class="tag_undertext">3 –ª—é–¥–µ–π –Ω–∞–ø–∏—Å–∞–ª–∏ –ø—Ä–æ —Ü–µ</p>
          <button class="tag_follow">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
    </div>
      <div class="tag_page_header">
          <p class="tag_head">üëèbravo</p>
          <p class="tag_undertext">1 –ª—é–¥–µ–π –Ω–∞–ø–∏—Å–∞–ª–∏ –ø—Ä–æ —Ü–µ</p>
          <button class="tag_follow">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
    </div>
    <div class="new_posts_div" start="0" end="5">

    </div>



</div>
{% endblock%}

{%block scripts_and_rest %}

<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="create_post_modal" ng-app="">
                <div class="post_header">
                    <img src="{{ url_for('static', filename='images/') }}{{user.user_photo.split(',')[0]}}" class="user_photo">
                    <div class="post_header_text">
                        <p class="user_name non_hover">Dmytro Lopushanskyy</p>
                    </div>
                    <span class="close" ng-click="place ='' ">&times;</span>
                </div>
                <div class="post_body">
                    <div contenteditable="true" class="create_post_textarea"></div>
                    <div class="create_post_images">
                        <!-- <div class="upload_div" id="up1000">
                          <img src="https://pbs.twimg.com/media/CYdrqGRWwAAdZM5.jpg" class="my_img image_uploaded" id="image_uploaded">
                          <i class="fa fa-window-close" aria-hidden="true"></i>
                        </div> -->
                    </div>
                </div>
                <p id="trigger_class" class="none"></p>
                <hr>
                <div class="post_add_div">
                    <form id="post_form" enctype="multipart/form-data">
                      <div class="input-file-container">
                        <input class="input-file" name="new_post_images" id="my-file" type="file" multiple="multiple" accept="image/*">
                        <label tabindex="0" for="my-file" class="input-file-trigger"><i class="fa fa-file-image-o" aria-hidden="true"></i>Add Images (<span class="img_num">4</span>)</label>
                        <label tabindex="0" for="check_in" class="input-file-trigger" id="check_in_div">
                            <i class="fa fa-map-marker check_icon" aria-hidden="true"></i>
                            <span class="default_text">Add Place</span>
                            <span class="place_check none" ng-bind="place"></span>
                            <input class="input-place none" id="check_in" type="text" ng-model="place">
                        </label>
                        <button class="input-file-trigger post_btn">POST</button>
                      </div>
                    </form>
                </div>
            </div>
  </div>
</div>

<div id="reactions_list" class="modal" start="0" end="10">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="create_post_modal">
                <div class="post_header">
                    <div class="post_header_text ml10">
                        <p class="user_name non_hover"><span class="react_quan"></span> reactions</p>
                    </div>
                    <span class="close close_btn" ">&times;</span>
                </div><hr>
                <div class="post_body">
                    <div id="floatingCirclesG" class="none">
                          <div class="f_circleG" id="frotateG_01"></div>
                          <div class="f_circleG" id="frotateG_02"></div>
                          <div class="f_circleG" id="frotateG_03"></div>
                          <div class="f_circleG" id="frotateG_04"></div>
                          <div class="f_circleG" id="frotateG_05"></div>
                          <div class="f_circleG" id="frotateG_06"></div>
                          <div class="f_circleG" id="frotateG_07"></div>
                          <div class="f_circleG" id="frotateG_08"></div>
                    </div>
                </div>

            </div>
  </div>
</div>




<span class="none" status="wait" id="new_posts_status"></span>

<div class="input-buffer"></div>

<div class="alert">
  <strong>POSTED!</strong>
</div>

<img src="{{ url_for('static', filename='images/') }}{{user.user_photo.split(',')[0]}}" class="test_img2">
<img src="{{ url_for('static', filename='images/') }}{{user.user_photo.split(',')[0]}}" class="test_img">


<script>

$(document).on('click', '.quantity p:first-child', function(e){
    $('#floatingCirclesG').removeClass('none')

    var id = $(this).parent().parent().parent().attr('id')
    $('#reactions_list').css('display', 'block')
    $("body").css("overflow", "hidden");
    $('#reactions_list .react_quan').text($('#' + id).find('.likes_quantity').text())

    var start = $('#reactions_list').attr('start')
    var end = $('#reactions_list').attr('end')
    console.log(start, end)

    $.ajax({
        url: '/get_reactions',
        data: JSON.stringify({'post_id': id, 'start': start, 'end': end}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status, response.react_list, response.end_of_reacts);
            if (response.end_of_reacts == 'true') {
                $('#floatingCirclesG').addClass('none')
            }else{
              $('#reactions_list').attr('start', Number(start)+10)
              $('#reactions_list').attr('end', Number(end)+10)
            }

            for (var i = 0; i <= response.react_list.length - 1; i++) {


                var curr = $('#reactions_list .post_body').prepend('<a href="'+ 'special?id='+ response.react_list[i][2][0] +'"><div class="user_reacted_div"><img src="'+ '/static/images/'+ response.react_list[i][2][5].split(',')[0] +'" class="user_photo"><div class="post_header_text"><p class="user_name non_hover">'+ response.react_list[i][2][1] + ' ' + response.react_list[i][2][2] +' </p></div><div class="user_reactions_div"><span class="user_reaction none">üëç</span><span class="user_reaction none">üòÇ</span><span class="user_reaction none">üòØ</span><span class="user_reaction none">üôÇ</span><span class="user_reaction none">üëè</span></div></div></a><hr class="hr_btw_reactions">')

                console.log('d',curr, response.react_list[i], response.react_list[i][2][5].split(',')[0], $('#reactions_list .post_body a:first-child .user_reactions_div .user_reaction:nth-child('+response.react_list[i][1]+')'), response.react_list[i][1])

                $('#reactions_list .post_body a:first-child .user_reactions_div .user_reaction:nth-child('+response.react_list[i][1]+')').removeClass('none')
            }
        },
        error: function(error) {
            console.log(error);
        }
    });
})

$(document).on('click', '.close_btn', function(e){
    $('#reactions_list a').remove()
    $('#reactions_list .hr_btw_reactions').remove()

    $('#reactions_list').css('display', 'none')
    $("body").css("overflow", "auto");
})


</script>





<script>

// getting posts



function loadNewPosts (){
    var start = $('.new_posts_div').attr('start')
    var end = $('.new_posts_div').attr('end')

    var id = $("#us_id").val();
    var action =  'get_posts'

    $.ajax({
        url: '/get_posts',
        data: JSON.stringify({'id':id, 'action': action, 'start':start, 'end': end}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status);
            if (response.end_of_posts == 'true') {
                $('.spinner').addClass('none')
            }else{
              $('.new_posts_div').attr('start', Number(start)+5)
              $('.new_posts_div').attr('end', Number(end)+5)
            }

            console.log('ddd')
            for (var i = 0; i <= response.posts_list.length - 1; i++) {

                $(".new_posts_div" ).append( '<div class="post" id="'+response.posts_list[i][0]+'"><div class="post_header"><img src="/static/images/'+ response.posts_list[i][10][5].split(',')[0] +'" class="user_photo"><div class="post_header_text"><a href="#"><p class="user_name">'+ response.posts_list[i][10][1] + ' '+  response.posts_list[i][10][2] +'</p></a><p class="post_info">' + response.posts_list[i][6] +', ' + response.posts_list[i][5] + '</p></div><div class="post_tags_div"></div><div class="post_dropdown dropbtn"><div class="dots_container dropbtn"><div class="dots"></div></div><div id="myDropdown" class="dropdown-content"><a href="#">Change Privacy</a><a href="#">Hide</a></div></div></div><div class="post_body"><p class="post_text">' + response.posts_list[i][2] +'</p><div class="post_images"></div></div><hr><div class="post_footer"><div class="footer_div reactions_div"><div class="reactions hide pointer"><i class="fa fa-heart-o react_btn like" aria-hidden="true"></i><span class="react_btn react2">üòÇ</span><span class="react_btn react3">üòØ</span> <span class="react_btn react4">üôÇ</span> <span class="react_btn react5">üëè</span> </div><span class="like_bottom pointer"><i class="fa fa-heart-o like_btn like" aria-hidden="true"></i></span><span class="react_btn like_btn none">üòÇ</span><span class="react_btn like_btn none">üòØ</span> <span class="react_btn like_btn none">üôÇ</span> <span class="react_btn like_btn none">üëè</span> <div class="connection"></div></div><div class="footer_div"><i class="fa fa-comment-o comment_btn pointer" aria-hidden="true"></i></div><div class="footer_div hey"><i class="fa fa-share share_btn pointer" aria-hidden="true"></i></div><div class="quantity"><p><span class="likes_quantity pointer">' + response.posts_list[i][8] +'</span> reactions,</p><p> <span class="comments_quantity pointer">' + response.posts_list[i][11] +'</span> comments,</p><p> <span class="shares_quantity pointer">0</span> shares</p></div></div><hr class="hr_none none"><div class="post_comments none" start="0" end="1"><div class="view_more pointer none"><p class="view_more_text">View More Comments...</p><br><p class="view_more_text none">Hide All Comments</p></div><div class="my_comment"><img src="{{ url_for('static', filename='images/') }}{{user.user_photo.split(',')[0]}}" class="comment_img my_img"><p class="comm_username tagbe_hover my_name">{{user.first_name}} {{user.last_name}}</p><form class="comment_form comm_form submit" method="get" action="" onsubmit="return false"><div class="textarea-container"><textarea class="my_textarea"></textarea><div class="textarea-size"></div></div><i class="fa fa-smile-o smile_icon right50" aria-hidden="true"></i><i class="fa fa-file-image-o smile_icon" aria-hidden="true"></i><p class="input_tip">Press Enter to submit</p></form></div></div></div>' );

                console.log('ddd', response.posts_list[i][3], response.posts_list[i][3].split(',') )

                // display right reaction

                for (var l = 0; l <= response.posts_list[i][9].length - 1; l++) {
                  console.log('user', response.posts_list[i][9][l][0], response.posts_list[i][9][l][1])
                  if (response.posts_list[i][9][l][0] == {{user.id}}) {
                      if (response.posts_list[i][9][l][1] == 1) {
                          $('#'+ response.posts_list[i][0] + ' .footer_div > span').addClass('none')
                          $('#'+ response.posts_list[i][0] + ' .footer_div > span:nth-child(2)').toggleClass('none')
                          $('#'+ response.posts_list[i][0] + ' .like').toggleClass('fa-heart-o fa-heart')
                      }else{
                          console.log('log', 'else', Number(response.posts_list[i][9][l][1]) + 1)
                          react_id = Number(response.posts_list[i][9][l][1]) + 1
                          $('#'+ response.posts_list[i][0] + ' .like').removeClass('fa-heart')
                          $('#'+ response.posts_list[i][0] + ' .like').addClass('fa-heart-o')
                          $('#'+ response.posts_list[i][0] + ' .footer_div > span').addClass('none')
                          $('#'+ response.posts_list[i][0] + ' .footer_div > span:nth-child('+ react_id +')').toggleClass('none')
                          $('#'+ response.posts_list[i][0] + ' .post_footer .footer_div:nth-child(1)').css("marginTop", "-20px")

                      }
                  }
                }




                if (response.posts_list[i][3] != '') {
                    for (var b = 0; b <= response.posts_list[i][3].split(',').length - 2; b++) {
                      console.log(response.posts_list[i][3].split(',')[b])
                      $('#'+response.posts_list[i][0]+ ' .post_images').append('<div class="img_container"><img src=" '+ '/static/images/' + response.posts_list[i][3].split(',')[b]  +' " class="post_img"></div>')
                    }
                }



                tags_array = response.posts_list[i][4]

                console.log('tagsall', tags_array, tags_array.split(','))
                if (tags_array != '') {
                    tags_array = tags_array.split(',')
                    for (var a = 0; a <= tags_array.length-1; a++) {
                      if (tags_array[a].split('')[0] == 'Ôäí') {
                        var symbol = ' #'
                        tags_array[a] = tags_array[a].substr(1);
                      }else{
                        var symbol = ' '
                      }

                      tags_array[a].toString()
                      console.log('tags', tags_array[a])


                      $('#'+response.posts_list[i][0]+ ' .post_tags_div').append('<a href="#"><p class="post_tag">'+ symbol + tags_array[a] +', </p></a>')

                    }
                }
                $('#new_posts_status').attr('status', '')
            }

            niceImages()
            aligning()

            // $('.post_img').load(function(){
            //     niceImages()
            //     aligning()
            // })


        },
        error: function(error) {
            console.log(error);
        }
    });

};

</script>



<script>

$('#view_friends').click(function(){
    window.location.href = 'friends_list?user=' + {{user.id}};
})

$(document).on('click', '#friends', function(e) {
    e.preventDefault()

    $('.friends_div').toggleClass('none')

    if (!$('.friends_div').hasClass('none') && $('.friends_div .row div').length == 0) {
        var start = $('#view_more_friends').attr('start')
        var end = $('#view_more_friends').attr('end')


        friends_avas()

        var id = $("#us_id").val();
        var action =  'get_friends'

        $.ajax({
            url: '/get_friends',
            data: JSON.stringify({'id':id, 'action': action, 'start':start, 'end': end, 'give_me_quantity': 'yes'}, null, '\t'),
            type: 'POST',
            contentType: 'application/json;charset=UTF-8',
            success: function(response) {
                console.log(response.status, response.friends_list);
                if (response.end_of_friends == 'true') {
                    $('#view_more_friends').addClass('none')
                }else{
                  $('#view_more_friends').attr('start', Number(start)+8)
                  $('#view_more_friends').attr('end', Number(end)+8)
                }

                if (response.quantity) {
                    $('#fr_quantity').html(response.quantity)
                }

                for (var i = 0; i <= response.friends_list.length - 1; i++) {
                    console.log('d', response.friends_list[i], response.friends_list[i][3].split(',')[0])
                    $('.friends_div .row').append('<div class="friend_item col-xs-3"><img src="'+ '/static/images/'+ response.friends_list[i][3].split(',')[0] +'" alt="Avatar" class="image" style="width:100%; height: 100%"><a href="'+ 'special?id='+ response.friends_list[i][0] +'"><div class="middle2"><div class="text2">'+ response.friends_list[i][1] +'<br> '+ response.friends_list[i][2] +'</div></div></a></div>')
                }
                friends_avas()
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

});


$(document).on('click', '#view_more_friends', function(e) {
    e.preventDefault()

    var start = $('#view_more_friends').attr('start')
    var end = $('#view_more_friends').attr('end')


    friends_avas()

    var id = $("#us_id").val();
    var action =  'get_friends'

    $.ajax({
        url: '/get_friends',
        data: JSON.stringify({'id':id, 'action': action, 'start':start, 'end': end}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status, response.friends_list);
            if (response.end_of_friends == 'true') {
                $('#view_more_friends').addClass('none')
            }else{
              $('#view_more_friends').attr('start', Number(start)+8)
              $('#view_more_friends').attr('end', Number(end)+8)
            }

            for (var i = 0; i <= response.friends_list.length - 1; i++) {
                console.log('d', response.friends_list[i], response.friends_list[i][3].split(',')[0])
                $('.friends_div .row').append('<div class="friend_item col-xs-3"><img src="'+ '/static/images/'+ response.friends_list[i][3].split(',')[0] +'" alt="Avatar" class="image" style="width:100%; height: 100%"><a href="'+ 'special?id='+ response.friends_list[i][0] +'"><div class="middle2"><div class="text2">'+ response.friends_list[i][1] +'<br> '+ response.friends_list[i][2] +'</div></div></a></div>')
            }
            friends_avas()
        },
        error: function(error) {
            console.log(error);
        }
    });

});

function friends_avas(){
    var width_item = $('.friends_div').width() / 4 - 8
    $('.friend_item').each(function(){
      $(this).css('height', width_item)
      $(this).css('width', width_item)
    })
    $('.friends_div').css('height', width_item * 3 + 23)
}

$('#view_groups').click(function(){
    window.location.href = 'groups_list?user=' + {{user.id}};
})

$(document).on('click', '#groups', function(e) {
    e.preventDefault()

    $('.groups_div').toggleClass('none')

    if (!$('.groups_div').hasClass('none') && $('.groups_div .row div').length == 0) {
        var start = $('#view_more_groups').attr('start')
        var end = $('#view_more_groups').attr('end')

        friends_avas()

        var id = $("#us_id").val();
        var action =  'get_groups'

        $.ajax({
            url: '/get_groups',
            data: JSON.stringify({'id':id, 'action': action, 'start':start, 'end': end, 'give_me_quantity': 'yes'}, null, '\t'),
            type: 'POST',
            contentType: 'application/json;charset=UTF-8',
            success: function(response) {
                console.log(response.status, response.friends_list);
                if (response.end_of_friends == 'true') {
                    $('#view_more_groups').addClass('none')
                }else{
                  $('#view_more_groups').attr('start', Number(start)+8)
                  $('#view_more_groups').attr('end', Number(end)+8)
                }

                if (response.quantity) {
                    $('#gr_quantity').html(response.quantity)
                }

                for (var i = 0; i <= response.friends_list.length - 1; i++) {
                    console.log('d', response.friends_list[i], response.friends_list[i][3].split(',')[0])
                    $('.groups_div .row').append('<div class="friend_item col-xs-3"><img src="'+ '/static/images/'+ response.friends_list[i][3].split(',')[0] +'" alt="Avatar" class="image" style="width:100%; height: 100%"><a href="'+ 'special?id='+ response.friends_list[i][0] +'"><div class="middle2"><div class="text2">'+ response.friends_list[i][1] +'</div></div></a></div>')
                }
                groups_avas()
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

});

$(document).on('click', '#view_more_groups', function(e) {
    e.preventDefault()

    var start = $('#view_more_groups').attr('start')
    var end = $('#view_more_groups').attr('end')


    friends_avas()

    var id = $("#us_id").val();
    var action =  'get_groups'

    $.ajax({
        url: '/get_groups',
        data: JSON.stringify({'id':id, 'action': action, 'start':start, 'end': end}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status, response.friends_list);
            if (response.end_of_friends == 'true') {
                $('#view_more_groups').addClass('none')
            }else{
              $('#view_more_groups').attr('start', Number(start)+8)
              $('#view_more_groups').attr('end', Number(end)+8)
            }

            for (var i = 0; i <= response.friends_list.length - 1; i++) {
                console.log('d', response.friends_list[i], response.friends_list[i][3].split(',')[0])
                $('.groups_div .row').append('<div class="friend_item col-xs-3"><img src="'+ '/static/images/'+ response.friends_list[i][3].split(',')[0] +'" alt="Avatar" class="image" style="width:100%; height: 100%"><a href="'+ 'special?id='+ response.friends_list[i][0] +'"><div class="middle2"><div class="text2">'+ response.friends_list[i][1] +'<br> '+ response.friends_list[i][2] +'</div></div></a></div>')
            }
            groups_avas()
        },
        error: function(error) {
            console.log(error);
        }
    });

});

function groups_avas(){
    var width_item = $('.groups_div').width() / 4 - 8
    $('.friend_item').each(function(){
      $(this).css('height', width_item)
      $(this).css('width', width_item)
    })
    $('.groups_div').css('height', width_item * 3 + 23)
}

</script>
<script>

$(document).on('click', '#refresh', function(e) {
    e.preventDefault()

    var id = $('#f_id').val()
    var f_name = $('#f_f_name').val()
    var l_name = $('#f_l_name').val()
    var pass = $('#f_password').val()
    var email = $('#f_email').val()
    var age = $('#f_age').val()
    var phone = $('#f_phone').val()
    var sex = $('#f_sex').val()
    var address = $('#f_address').val()

    $.ajax({
        url: '/add_edit',
        data: JSON.stringify({'f_name':f_name, 'l_name': l_name, 'new_pass':pass, 'id': id, 'new_email':email, 'age': age, 'phone':phone, 'address': address, 'sex': sex}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status);
            $('#info').toggleClass('none')
            $('#editting').toggleClass('none')
            location.reload();
        },
        error: function(error) {
            console.log(error);
        }
    });
});

$(document).on('click', '#edit', function(e) {
    e.preventDefault()
    $('#info').toggleClass('none')
    $('#editting').toggleClass('none')
});



function readURL3(input) {
    var numFiles = input.files.length;

    if (input.files && input.files[0]) {

     var reader = new FileReader();
      reader.onload = function (e) {

          var form_data = new FormData($('#form_back')[0]);
          $.ajax({
              type: 'POST',
              url: '/upload?' + 'user_type=user&' + 'type=back' ,
              data: form_data,
              contentType: false,
              cache: false,
              processData: false,
              async: false,
              success: function(response) {
                  $('.photos_container').css('background-image','url('+ e.target.result + ')');
                  $('.test_img').attr('src', e.target.result);
                  console.log(response.status);
              },
              error: function(error) {
                  console.log(error);
              }
          });

      }
      reader.readAsDataURL(input.files[0]);
    }
}

$(document).on('change', '#back_photo', function(e){
    readURL3(this);
});




function readURL2(input) {
    var numFiles = input.files.length;

    if (input.files && input.files[0]) {

      var reader = new FileReader();
      reader.onload = function (e) {

          var form_data = new FormData($('#form_ava')[0]);
          $.ajax({
              type: 'POST',
              url: '/upload?' + 'user_type=user&' + 'type=ava' ,
              data: form_data,
              contentType: false,
              cache: false,
              processData: false,
              async: false,
              success: function(response) {
                  $('.profile_photo_user').attr('src', e.target.result);
                  $('.test_img2').attr('src', e.target.result);
                  console.log(response.status);
                  location.reload()
              },
              error: function(error) {
                  console.log(error);
              }
          });
      }
      reader.readAsDataURL(input.files[0]);
    }
}

$(document).on('change', '#profile_photo', function(e){
    readURL2(this);
});

$('.test_img2').on('load', function(){
    console.log('heeeere', $('.test_img2'),$('.test_img2').width(), $('.test_img2').height())
    if ($('.test_img2').width() > $('.test_img2').height()) {
        console.log('widthmore')
        $('.profile_photo_user').css('height', '174px');
        $('.profile_photo_user').css('width', 'auto');
    }else{
        $('.profile_photo_user').css('width', '174px');
        $('.profile_photo_user').css('height', 'auto');
    }
});

$(document).ready(function(){
    if ($('.test_img2').width() > $('.test_img2').height()) {
        console.log('widthmore')
        $('.profile_photo_user').css('height', '174px');
        $('.profile_photo_user').css('width', 'auto');
    }else{
        $('.profile_photo_user').css('width', '174px');
        $('.profile_photo_user').css('height', 'auto');
    }

});



$(document).on('mouseover', '.photos_container', function(e) {
    if ($('.ava').children('.overlay').hasClass('none')) {
      $(this).children('.overlay').removeClass('none')
    }

});
$(document).on('mouseleave', '.photos_container', function(e) {
    $(this).children('.overlay').addClass('none')
});

$(document).on('mouseover', '.ava', function(e) {
    $('.photos_container').children('.overlay').addClass('none')
    $(this).children('.overlay').removeClass('none')
});
$(document).on('mouseleave', '.ava', function(e) {
    $(this).children('.overlay').addClass('none')
});


$(document).on('click', '#about', function(e) {
    e.preventDefault()
    $('#info').removeClass('none')
    $('#editting').addClass('none')
});

$(document).ready(function(e) {
    var bodyHeight = $('body').height()
    $('.height100').css('height', bodyHeight)
});

</script>





<script>

function readURL20() {
    input = $('#my-file')[0]
    var files_array = []
    var numFiles = input.files.length;

    if (input.files && input.files[0]) {

      var reader = new FileReader();
      reader.onload = function (e) {

          var form_data = new FormData($('#post_form')[0]);

          $.ajax({
                type: 'POST',
                url: '/post' ,
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                async: false,
                success: function(response) {
                    console.log(response.status);

                },
                error: function(error) {
                    console.log(error);
                }
            });

          for (var value of form_data.values()) {

            files_array.push(value)
             console.log(value);
          }
          console.log('form_data', files_array);
          return files_array
      }
      reader.readAsDataURL(input.files[0]);
    }
}
function img_upload(callback) {
  input = $('#my-file')[0]
    var files_array = []
    var numFiles = input.files.length;

    if (input.files && input.files[0]) {

      var reader = new FileReader();


      reader.onload = function (e) {

          var form_data = new FormData($('#post_form')[0]);


          for (var value of form_data.values()) {
            console.log('infunc', value)

          }
          callback(form_data);

      }
      reader.readAsDataURL(input.files[0]);
    }else{
      callback(undefined);
    }
}


$(document).on('click', '.post_btn', function(e) {
    e.preventDefault()



    var text = $('.create_post_textarea').html()
    text = text.split('')
    var image_being = $('.post_images').length



    var delete_cur
    var aditional = 0
    var array_length = text.length
    for (var i = 0; i <= text.length - 1 + aditional ; i++) {
        aditional = array_length - text.length
        if (text[i-aditional] == '<'){
            delete_cur = i-aditional
        }else if (text[i-aditional] == '>'){
            text.splice(delete_cur, i-aditional - delete_cur + 1)
        }
    }
    for (var i = 0; i <= text.length - 1 + aditional ; i++) {
        aditional = array_length - text.length
        if (text[i-aditional] == '<'){
            delete_cur = i-aditional
        }else if (text[i-aditional] == '>'){
            text.splice(delete_cur, i-aditional - delete_cur + 1)
        }
    }

    if (text.length == 0 && image_being == 1) {
      console.log('leer')
      return
    }
    modal.style.display = "none";

    text = text.join('');

    console.log('1')
    img_upload(function(result){
      form_data = result
      console.log('heyhey',  form_data);



      city = $('.place_check').html();
      var tags_array = [];

    $('.create_post_textarea .hastag_changed').each(function(){
         console.log('found!')
        tags_array.push($(this).val())
    });

      if (form_data != undefined) {

          for (var value of form_data.values()) {
            console.log('outfunc', value)

          }

          form_data.append('text', text)
          form_data.append('tags', tags_array)
          form_data.append('location', city)
          form_data.append('date', new Date().toLocaleString())

          $.ajax({
                type: 'POST',
                url: '/post' ,
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                async: false,
                success: function(response) {
                    console.log(response.status, response.post_id, 'searching');
                    $('#new_posts_status').text(response.post_id)
                },
                error: function(error) {
                    console.log(error);
                }
            });
      }else{
          console.log('else')
          var form_data = new FormData($('#post_form')[0]);

          form_data.append('text', text)
          form_data.append('tags', tags_array)
          form_data.append('location', city)
          form_data.append('date', new Date().toLocaleString())

          $.ajax({
                type: 'POST',
                url: '/post' ,
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                async: false,
                success: function(response) {
                    console.log(response.status, response.post_id, 'searching');
                    $('#new_posts_status').text(response.post_id)

                },
                error: function(error) {
                    console.log(error);
                }
            });
      }


      city = $('.place_check').html();


      id = $('#new_posts_status').html()

      $(".new_posts_div" ).prepend( '<div class="post" id="'+id+'"><div class="post_header"><img src="{{ url_for('static', filename='images/') }}{{user.user_photo.split(',')[0]}}" class="user_photo"><div class="post_header_text"><a href="#"><p class="user_name">{{user.first_name}} {{user.last_name}}</p></a><p class="post_info">' + new Date().toLocaleString() +', ' + city + '</p></div><div class="post_tags_div"></div><div class="post_dropdown dropbtn"><div class="dots_container dropbtn"><div class="dots"></div></div><div id="myDropdown" class="dropdown-content"><a href="#">Change Privacy</a><a href="#">Hide</a></div></div></div><div class="post_body"><p class="post_text">' + text +'</p><div class="post_images"></div></div><hr><div class="post_footer"><div class="footer_div reactions_div"><div class="reactions hide pointer"><i class="fa fa-heart-o react_btn like" aria-hidden="true"></i><span class="react_btn react2">üòÇ</span><span class="react_btn react3">üòØ</span> <span class="react_btn react4">üôÇ</span> <span class="react_btn react5">üëè</span> </div><span class="like_bottom pointer"><i class="fa fa-heart-o like_btn like" aria-hidden="true"></i></span><span class="react_btn like_btn none">üòÇ</span><span class="react_btn like_btn none">üòØ</span> <span class="react_btn like_btn none">üôÇ</span> <span class="react_btn like_btn none">üëè</span> <div class="connection"></div></div><div class="footer_div"><i class="fa fa-comment-o comment_btn pointer" aria-hidden="true"></i></div><div class="footer_div hey"><i class="fa fa-share share_btn pointer" aria-hidden="true"></i></div><div class="quantity"><p><span class="likes_quantity pointer">0</span> reactions,</p><p> <span class="comments_quantity pointer">0</span> comments,</p><p> <span class="shares_quantity pointer">0</span> shares</p></div></div><hr class="hr_none none"><div class="post_comments none" start="0" end="1"><div class="view_more pointer none"><p class="view_more_text">View More Comments...</p><br><p class="view_more_text none">Hide Comments</p></div><div class="my_comment"><img src="{{ url_for('static', filename='images/') }}{{user.user_photo.split(',')[0]}}" class="comment_img my_img"><p class="comm_username tagbe_hover my_name">{{user.first_name}} {{user.last_name}}</p><form class="comment_form comm_form submit" method="get" action="" onsubmit="return false"><div class="textarea-container"><textarea class="my_textarea"></textarea><div class="textarea-size"></div></div><i class="fa fa-smile-o smile_icon right50" aria-hidden="true"></i><i class="fa fa-file-image-o smile_icon" aria-hidden="true"></i><p class="input_tip">Press Enter to submit</p></form></div></div></div>' );

      var src
      $('.create_post_images .upload_div').each(function(){
          src = $(this).find('.image_uploaded').attr('src');
          console.log('qwerty', id, $('#'+id+ ' .post_images'), '#'+id+ ' .post_images')
          $('#'+id+ ' .post_images').append('<div class="img_container"><img src=" '+ src +' " class="post_img"></div>')
      })

      tags_array = [];

      $('.create_post_textarea .hastag_changed').each(function(){
           console.log('found!')
          tags_array.push($(this).val())
      });

      for (var i = 0; i <= tags_array.length-1; i++) {
        if (tags_array[i].split('')[0] == 'Ôäí') {
          var symbol = ' #'
          tags_array[i] = tags_array[i].substr(1);
        }else{
          var symbol = ' '
        }

        $('#'+id+ ' .post_tags_div').append('<a href="#"><p class="post_tag">'+ symbol + tags_array[i] +', </p></a>')

      }


      niceImages()
      aligning()

      $("body").css("overflow", "auto");

      $('.place_check').addClass('none')
      $('.default_text').removeClass('none')

      $('.create_post_images').empty()

      $( "#trigger_class" ).trigger( "click" );

      $('.alert').addClass('appear_alert')

      setTimeout(function(){
        $('.alert').removeClass('appear_alert')
        $('.alert').addClass('hide_alert')
      },2000);
      setTimeout(function(){
        $('.alert').removeClass('hide_alert')
      },2500);
    });


});

// empty all inputs
// $('#trigger_class').on('click', function(e){
//    var $el = $('#my-file');
//    $el.wrap('<form>').closest('form').get(0).reset();
//    $el.unwrap();

//     $('.create_post_textarea').html('')
//     $('.create_post_textarea').css('height', 'auto')
//     $('.img_num').html(4)

// });
</script>
<script>

$(document).on('keyup', '.post_text_edit', function(e) {
    $(e.target).remove()
    $('.create_post_textarea').focus()
});

  // searching for hastag
$(document).on('keyup', '.create_post_textarea', function(e) {
    var post_array = []
    var post_text = $('.create_post_textarea').html()
    post_text = post_text.replace(/<br>/g,'');
    post_text = post_text.replace(/&nbsp;/g,'');
    for (var i = 0, len = post_text.length; i < len; i++) {
      post_array.push(post_text.charAt(i))
      if ((post_text.charAt(i) == '#') && (post_text.charAt(i-2) != '' && post_text.charAt(i-1) != '>' || post_text.charAt(i+1) != '<')){
        insertTag(i)
        $('.choose_tag_input').focus();
      }
    }
});
$(document).on('keyup', 'input[name=tag]', function(e) {
    var post_text = $('input[name=tag]').val()
    post_text = post_text.replace(/#/g,'');
    $('input[name=tag]').val(post_text)
});
$(document).on('change', '.fa-select', function(e) {
    $('input[name=tag]').focus()
});

function insertTag(index){
    $(".create_post_textarea").html(function(i,v){
      console.log(v)
      data = v.replace(/>#</g,'><');
      console.log(data)
      return data.replace(/#/g , '<div class="choose_tag" contenteditable="false"><select class="fa-select" name="hash_selector"><option value="hash">#</option><option value="laugh">üòÇ</option><option value="wow">üòØ</option><option value="smile">üôÇ</option><option value="applause">üëè</option></select><input type="text" name="tag" placeholder="Hastag" class="choose_tag_input"><p class="ok">OK</p><p class="cancel">CANCEL</p></div>' )
    });
}
$('.create_post_textarea').on('keypress', function(e) {
   if(e.which == 13) {
        var hashtag = $('select[name=hash_selector]').val()
        var insert = hashtag
        var input = $('input[name=tag]').val()
        console.log(hashtag)
        if (input == undefined){
          return
        }
        if (input == ''){
          return  $(e.target).parent().replaceWith('')
        }
        $("body").bind("DOMNodeInserted", function() {
           prependClass($(this).find('.hastag_changed'), '_'+insert+'-')
        });
        if (hashtag == 'hash'){
          hashtag = '&#xf292;'
        }
        if (hashtag == 'laugh'){
          hashtag = 'üòÇ'
        }
        if (hashtag == 'wow'){
          hashtag = 'üòØ'
        }
        if (hashtag == 'smile'){
          hashtag = 'üôÇ'
        }
        if (hashtag == 'applause'){
          hashtag = 'üëè'
        }

        $(e.target).parent().replaceWith('<input class="hastag_changed autoresize" contenteditable="true" value="'+ hashtag + input + '"></input><input class="post_text_edit" contenteditable="true"> </input>')
        // var $input = $('.hastag_changed'),
        //     $buffer = $('.input-buffer');

        // $buffer.text($input.val());
        // $input.width($buffer.width());

        $('.hastag_changed').attr('size', $('.hastag_changed').val().length);
        $('.post_text_edit').focus()



    $(".create_post_textarea").val($(".create_post_textarea").val())
    console.log(hashtag, input, $(e.target).parent())
    }
});


$(document).on('click', '.ok', function(e) {
    var hashtag = $('select[name=hash_selector]').val()
    var insert = hashtag
    var input = $('input[name=tag]').val()
    if (input == ''){
      return  $(e.target).parent().replaceWith('')
    }
    $("body").bind("DOMNodeInserted", function() {
      prependClass($(this).find('.hastag_changed'), '_'+insert+'-')
    });
    if (hashtag == 'hash'){
      hashtag = '&#xf292;'
    }
    if (hashtag == 'laugh'){
      hashtag = 'üòÇ'
    }
    if (hashtag == 'wow'){
      hashtag = 'üòØ'
    }
    if (hashtag == 'smile'){
      hashtag = 'üôÇ'
    }
    if (hashtag == 'applause'){
      hashtag = 'üëè'
    }
    $(e.target).parent().replaceWith('<input class="hastag_changed autoresize" contenteditable="true" value="'+ hashtag + input + '"></input>')
    $('.hastag_changed').attr('size', $('.hastag_changed').val().length);
    $('.create_post_textarea').focus()
    $(".create_post_textarea").val($(".create_post_textarea").val())
    console.log(hashtag, input, $(e.target).parent())
});

function prependClass(sel, strClass) {
    var $el = sel
    console.log($el, strClass)
    /* prepend class */
    var classes = $el.attr('class');
    classes = strClass +' ' +classes;
    $el.removeClass()
    $el.attr('class', classes);
}

$(document).on('focusin', '.hastag_changed', function(e) {
    var text = $('.hastag_changed').attr('value').substring(1, $('.hastag_changed').attr('value').length)
    var option = 'hash'
    var emotion = $(".hastag_changed[class^='_'],.hastag_changed[class*='-']").attr('class').split(' ')[0].slice(1,-1)
    if(emotion!='hash'){
      text = $('.hastag_changed').attr('value').substring(2, $('.hastag_changed').attr('value').length)
    }

    console.log(emotion, option)
    var input = $('input[name=tag]').val()

    $(e.target).replaceWith('<div class="choose_tag" contenteditable="false"><select class="fa-select" name="hash_selector"><option value="hash">#</option><option value="laugh">üòÇ</option><option value="wow">üòØ</option><option value="smile">üôÇ</option><option value="applause">üëè</option></select><input type="text" class="choose_tag_input" name="tag" placeholder="Hastag" value="'+ text +'"><p class="ok">OK</p><p class="cancel">CANCEL</p></div>')
    $('input[name=tag]').focus()
    var val = $('input[name=tag]').val();
    $('input[name=tag]').val('');
    $('input[name=tag]').val(val);

    $("select[name=hash_selector]").val(emotion);
});

$(document).on('click', '.cancel', function(e) {
    $(e.target).parent().replaceWith('')
});

$(document).mouseup(function(e) {
    var container = $(".choose_tag_input").parent();

    // if the target of the click isn't the container nor a descendant of the container
    if (!container.is(e.target) && container.has(e.target).length === 0)
    {
        container.remove();
    }
});
</script>




<script>

$(document).on('click', "#check_in_div", function(e){
    $('.check_icon').addClass('none')
    $('.default_text').addClass('none')
    $('#check_in').removeClass('none')
    $('#check_in_div').addClass('blue_color')
    $('.place_check').addClass('none')
});

$("#check_in").focusout(function(){
    $('.check_icon').removeClass('none')
    if ($('.place_check').html() != ''){
        $('.place_check').removeClass('none')
    }else{
        $('.default_text').removeClass('none')
    }

    $('#check_in').addClass('none')
    $('#check_in_div').removeClass('blue_color')
});


</script>


<script>

document.querySelector("html").classList.add('js');

var fileInput  = document.querySelector( ".input-file" ),
    button     = document.querySelector( ".input-file-trigger" ),
    the_return = document.querySelector(".file-return");

button.addEventListener( "keydown", function( event ) {
    if ( event.keyCode == 13 || event.keyCode == 32 ) {
        fileInput.focus();
    }
});
button.addEventListener( "click", function( event ) {
   fileInput.focus();
   return false;
});

function readURL(input) {
    var numFiles = input.files.length;

    if (input.files && input.files[0]) {
        var num = Number($( ".img_num" ).html())
        if (num != 0){
          for (var i = 0; i < num; i++) {
              var reader = new FileReader();
              reader.onload = function (e) {
                  $( ".create_post_images" ).prepend('<div class="upload_div" id="' + Math.random() +'"><img src="'+ e.target.result +'" class="my_img image_uploaded" id="image_uploaded"><i class="fa fa-window-close" aria-hidden="true"></i></div>');
                var num = Number($( ".img_num" ).html()) - 1
                $( ".img_num" ).html(num)
              }
              reader.readAsDataURL(input.files[i]);
          }
        }
    }
}
$("#my-file").change(function(){
    readURL(this);
});


$(document).ready ( function () {
    $(document).on ("click", ".upload_div i", function (e) {
        $(e.target).parent().remove()

        var num = Number($( ".img_num" ).html()) + 1
        $( ".img_num" ).html(num)
    });
});

</script>


<script>
// Get the modal
var modal = document.getElementById('myModal');

// Get the button that opens the modal
var btn = document.getElementById("myBtn");
var btn2 = document.getElementById("myBtn2");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal
btn.onclick = function() {
    modal.style.display = "block";
    $("body").css("overflow", "hidden");
}
btn2.onclick = function() {
    modal.style.display = "block";
    $("body").css("overflow", "hidden");
}



span.onclick = function() {
    var warn = confirm("Delete this post?");
    if (warn == true) {
        modal.style.display = "none";
        $("body").css("overflow", "auto");

        $('.place_check').addClass('none')
        $('.default_text').removeClass('none')

        $('.create_post_images').empty()

        $( "#trigger_class" ).trigger( "click" );
    } else {

    }

}

// empty all inputs
$('#trigger_class').on('click', function(e){
   var $el = $('#my-file');
   $el.wrap('<form>').closest('form').get(0).reset();
   $el.unwrap();

    $('.create_post_textarea').html('')
    $('.create_post_textarea').css('height', 'auto')
    $('.img_num').html(4)

});


// When the user clicks anywhere outside of the modal, close it


jQuery.each(jQuery('textarea[data-autoresize]'), function() {
    var offset = this.offsetHeight - this.clientHeight;

    var resizeTextarea = function(el) {
        jQuery(el).css('height', 'auto').css('height', el.scrollHeight + offset);
    };
    jQuery(this).on('keyup input', function() { resizeTextarea(this); }).removeAttr('data-autoresize');
});
</script>



<script src="{{ url_for('static', filename='js/aligning.js') }}"></script>


<script>


$(document).on('click', '.comm_dropdown_div', function(e) {
    var parent = $(this).parent().parent().parent().parent().attr('id')
    console.log(parent)

    $('#'+ parent + ' .comm_dropdown').toggleClass("show");
});


$(document).on('click', '.post_dropdown', function(e){
    var parent = $(this).parent().parent().attr('id')

    $('#'+ parent + ' #myDropdown').toggleClass("show");
});

window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {

    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}

$(document).on('mouseover', '.post_footer .footer_div:first-child', function(e){
    var parent = $(this).parent().parent().attr('id')

    $('#'+ parent + ' .reactions').removeClass('hide')
    $('#'+ parent + ' .reactions').addClass('show')
});
$(document).on('mouseleave', '.post_footer .footer_div:first-child', function(e){
    var parent = $(this).parent().parent().attr('id')

    setTimeout(function(){
        $('#'+ parent + ' .reactions').addClass('hide')
    }, 500);
    setTimeout(function(){
        $('#'+ parent + ' .reactions').removeClass('show')
    }, 900);
});

$(document).on('mouseover', '.comment', function(e) {
    console.log('yeah')
    var parent = $(this).parent().parent().attr('id')
    var name = $('#username strong').html()
    var id = Number($(this).attr('id'))
    var comm_name =  $('#'+ id + ' .comm_username').html()
    console.log(parent,id)
    if (name == comm_name) {
        $('#'+ id).children( ".comm_hover" ).removeClass('none')
    }else{
      console.log(false)
    }
});

$(document).ready(function(e) {
  $( ".post" ).each(function() {
      id = Number($(this).attr('id'))

      var name = $('#username strong').html()
      var user_post_name =  $('#'+ id + ' .post_header .user_name').html()

      console.log(parent,id)
      if (name != user_post_name) {
          $('#'+ id + ' .post_header .post_dropdown').addClass('none')
      }

    });

});

$(document).on('mouseleave', '.comment', function(e) {
    $('.comm_hover').addClass('none')
});

$(document).on('click', '.delete_comm', function(e) {
    var id = Number($(this).parent().parent().parent().attr('id'))
    var parent = Number($('#' + id).parent().parent().attr('id'))

    $('#' + id).remove()
    if($('#'+ parent + ' .view_more_text:first-child').hasClass('none')){
        if($('#'+ parent + ' .post_comments .comment:first-child').hasClass('more_comm')){
            $('#'+ parent + ' .post_comments .comment:first-child').removeClass('more_comm')
        }
        CountComments(parent)
    }else{
        CountComments(parent)

        if($('#'+ parent + ' .post_comments .comment:first-child').hasClass('more_comm')){
            $('#'+ parent + ' .post_comments .comment:first-child').removeClass('more_comm none')
        }

    }

    num = Number($('#'+ parent +' .comments_quantity').html()) - 1
    $('#'+ parent + ' .comments_quantity').html(num)

});

$(document).on('click', '.like', function(e){
    var parent = $(this).parent().parent().parent().parent().attr('id')
    addReaction(1, parent)

    if (!$('#'+ parent +' .like').hasClass('fa-heart') && !$('#'+ parent +' .like_bottom').hasClass('none')) {
        num = Number($('#'+ parent +' .likes_quantity').html()) + 1
        $('#'+ parent + ' .likes_quantity').html(num)

    }else{
        if (!$('#'+ parent + ' .like_bottom').hasClass('none')) {
            num = Number($('#'+ parent + ' .likes_quantity').html()) - 1
            $('#'+ parent + ' .likes_quantity').html(num)
            removeReaction(1, parent)
        }


    }

    $('#'+ parent + ' .footer_div > span').addClass('none')
    $('#'+ parent + ' .footer_div > span:nth-child(2)').toggleClass('none')
    $('#'+ parent + ' .like').toggleClass('fa-heart-o fa-heart')



});

$(document).on('click', '.react2', function(e){
    var parent = $(this).parent().parent().parent().parent().attr('id')

    if (!$('#'+ parent + ' .like_bottom').hasClass('none') && $('#'+ parent + ' .like').hasClass('fa-heart-o')) {
        num = Number($('#'+ parent + ' .likes_quantity').html()) + 1
        $('#'+ parent + ' .likes_quantity').html(num)

    }
    addReaction(2, parent)
    $('#'+ parent + ' .like').removeClass('fa-heart')
    $('#'+ parent + ' .like').addClass('fa-heart-o')
    $('#'+ parent + ' .footer_div > span').addClass('none')
    $('#'+ parent + ' .footer_div > span:nth-child(3)').toggleClass('none')
    $('#'+ parent + ' .post_footer .footer_div:nth-child(1)').css("marginTop", "-20px")
});

$(document).on('click', '.react3', function(e){
    var parent = $(this).parent().parent().parent().parent().attr('id')

    if (!$('#'+ parent + ' .like_bottom').hasClass('none') && $('#'+ parent + ' .like').hasClass('fa-heart-o')) {
        num = Number($('#'+ parent + ' .likes_quantity').html()) + 1
        $('#'+ parent + ' .likes_quantity').html(num)

    }
    addReaction(3, parent)
    $('#'+ parent + ' .like').removeClass('fa-heart')
    $('#'+ parent + ' .like').addClass('fa-heart-o')
    $('#'+ parent + ' .footer_div > span').addClass('none')
    $('#'+ parent + ' .footer_div > span:nth-child(4)').toggleClass('none')
    $('#'+ parent + ' .post_footer .footer_div:nth-child(1)').css("marginTop", "-20px")
});

$(document).on('click', '.react4', function(e){
    var parent = $(this).parent().parent().parent().parent().attr('id')

    if (!$('#'+ parent + ' .like_bottom').hasClass('none') && $('#'+ parent + ' .like').hasClass('fa-heart-o')) {
        num = Number($('#'+ parent + ' .likes_quantity').html()) + 1
        $('#'+ parent + ' .likes_quantity').html(num)

    }
    addReaction(4, parent)
    $('#'+ parent + ' .like').removeClass('fa-heart')
    $('#'+ parent + ' .like').addClass('fa-heart-o')
    $('#'+ parent + ' .footer_div > span').addClass('none')
    $('#'+ parent + ' .footer_div > span:nth-child(5)').toggleClass('none')
    $('#'+ parent + ' .post_footer .footer_div:nth-child(1)').css("marginTop", "-20px")
});

$(document).on('click', '.react5', function(e){
    var parent = $(this).parent().parent().parent().parent().attr('id')

    if (!$('#'+ parent + ' .like_bottom').hasClass('none') && $('#'+ parent + ' .like').hasClass('fa-heart-o')) {
        num = Number($('#'+ parent + ' .likes_quantity').html()) + 1
        $('#'+ parent + ' .likes_quantity').html(num)


    }
    addReaction(5, parent)
    $('#'+ parent + ' .like').removeClass('fa-heart')
    $('#'+ parent + ' .like').addClass('fa-heart-o')
    $('#'+ parent + ' .footer_div > span').addClass('none')
    $('#'+ parent + ' .footer_div > span:nth-child(6)').toggleClass('none')
    $('#'+ parent + ' .post_footer .footer_div:nth-child(1)').css("marginTop", "-20px")
});

$(document).on('dblclick', '.post', function(e){
    var parent = $(this).attr('id')
    if (!$('#'+ parent + ' .like').hasClass('fa-heart') && !$('#'+ parent + ' .like_bottom').hasClass('none')) {
        num = Number($('#'+ parent + ' .likes_quantity').html()) + 1
        $('#'+ parent + ' .likes_quantity').html(num)
        addReaction(1, parent)
    }else{
        if (!$('#'+ parent + ' .like_bottom').hasClass('none')) {
            num = Number($('#'+ parent + ' .likes_quantity').html()) - 1
            $('#'+ parent + ' .likes_quantity').html(num)

            removeReaction(1, parent)
        }
    }

    if (!$('#'+ parent + ' .like_bottom').hasClass('none')) {
        $('#'+ parent + ' .like').toggleClass('fa-heart-o fa-heart')
    }else{
        $('#'+ parent + ' .post_footer span:nth-child(3), .post_footer span:nth-child(4), .post_footer span:nth-child(5), .post_footer span:nth-child(6)').addClass('none')
        $('#'+ parent + ' .post_footer span:nth-child(2)').removeClass('none')
        $('#'+ parent + ' .reactions span:nth-child(3), .reactions span:nth-child(4), .reactions span:nth-child(5), .reactions span:nth-child(6)').removeClass('none')
        num = Number($('#'+ parent + ' .likes_quantity').html()) - 1
        $('#'+ parent + ' .likes_quantity').html(num)

        removeReaction(1, parent)
    }
});

function addReaction(reaction, post_id){
    $.ajax({
        url: '/reaction',
        data: JSON.stringify({'reaction': reaction, 'post_id': post_id, 'date': Date().toLocaleString()}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status);
        },
        error: function(error) {
            console.log(error);
        }
    });
}

function removeReaction(reaction, post_id){
    $.ajax({
        url: '/remove_reaction',
        data: JSON.stringify({'reaction': reaction, 'post_id': post_id}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status);
        },
        error: function(error) {
            console.log(error);
        }
    });
}

var textContainer, textareaSize, input;
var autoSize = function () {
  textareaSize.innerHTML = input.value + '\n';
};
var clear = function () {
  textareaSize.innerHTML = input.value;
};
$(document).on('keydown', 'textarea', function(event) {
    if (event.keyCode == 13)
        if (!event.shiftKey) submitData()
});

var focusId = 1

$(document).on('focusin', '.comment_form textarea', function(e){
    var parent = $(this).parent().parent().parent().parent().parent().attr('id')

    window.focusId = Number(parent)

    window.textareaSize = $('#' + focusId+ ' .textarea-size').get()[0]
    window.input = $('#'+ focusId+ ' textarea').get()[0]

    autoSize();
    input.addEventListener('input', autoSize);
});

function CountComments(parent){
    var comm_length = $('#'+ parent + " .post_comments .comment").length

    if (comm_length >= 2){
        $('#'+ parent + ' .view_more').removeClass('none')
    }else{
        console.log(comm_length, false)
        $('#'+ parent + ' .view_more').addClass('none')
    }
}

$(document).on('click', '.comment_btn', function(e){
    var parent = $(this).parent().parent().parent().attr('id')
    var parent_div = $(this).parent().parent().parent()
    if ($(this).parent().parent().parent().find('.post_comments').hasClass('none')) {
        var start = $(this).parent().parent().parent().find('.post_comments').attr('start')
        var end = $(this).parent().parent().parent().find('.post_comments').attr('end')

        $.ajax({
            url: '/get_comments',
            data: JSON.stringify({'post_id': parent, 'start': start, 'end': end}, null, '\t'),
            type: 'POST',
            contentType: 'application/json;charset=UTF-8',
            success: function(response) {
                console.log(response.status);
                console.log(response.comments_list);
                $('#'+ parent + ' .comment_btn').toggleClass('fa-comment-o fa-comment')
                $('#'+ parent + ' .post_comments').toggleClass('none')
                $('#'+ parent + ' .hr_none').toggleClass('none')
                $('#'+ parent + ' .comment_form textarea').focus();
                for (var i = 0; i <= response.comments_list.length - 1; i++) {
                    console.log(response.comments_list[i]);
                    $( '#'+ focusId + " .post_comments" ).prepend( '<div class="comment" id ="'+response.comments_list[i][1]+'"><img src="static/images/'+response.comments_list[i][6][5].split(',')[0]+'" class="comment_img"><p class="comm_username tagbe_hover">'+response.comments_list[i][6][1]+ ' ' + response.comments_list[i][6][2]+'</p><form class="comment_form"><div class="comm_text width100"><div>'+response.comments_list[i][4]+'</div></div></form><div class="dropbtn comm_hover none"><div class="comm_dropdown_div dots_container dropbtn"><div class="dots"></div></div><div class="dropdown-content comm_dropdown"><a class="delete_comm">Delete</a></div></div></div>' );
                }
                if (response.end_of_comm == 'false') {
                    $('#'+ parent + ' .view_more').removeClass('none')
                    $('#'+ parent + ' .view_more .view_more_text:nth-child(1)').removeClass('none')
                }else{
                    $('#'+ parent + ' .view_more .view_more_text:nth-child(1)').addClass('none')
                }

                console.log('dmytro')
                parent_div.find('.post_comments').attr('start', '1')
                parent_div.find('.post_comments').attr('end', '6')
                console.log('dmytro', parent_div.find('.post_comments'))
                $('#'+ parent + ' .view_more_text').removeClass('none')
            },
            error: function(error) {
                console.log(error);
            }
        });

    }else{
        $(this).parent().parent().parent().find('.post_comments .comment').remove()
        $('#'+ parent + ' .comment_btn').toggleClass('fa-comment-o fa-comment')
        $('#'+ parent + ' .post_comments').toggleClass('none')
        $('#'+ parent + ' .hr_none').toggleClass('none')
        $('#'+ parent + ' .comment_form textarea').focus()
        $(this).parent().parent().parent().find('.post_comments').attr('start', '0')
        $(this).parent().parent().parent().find('.post_comments').attr('end', '1')

    }


});

$(document).on('click', '.view_more_text', function(e){
    var parent = $(this).parent().parent().parent().attr('id')
    console.log('here', $(this).text())
    if($(this).text() == 'View More Comments...'){
        var parent_div = $(this).parent().parent().parent()
        // $('#'+ parent + ' .view_more_text').toggleClass('none')
        // $('#'+ parent + ' .more_comm').toggleClass('none')

        var start = $(this).parent().parent().parent().find('.post_comments').attr('start')
        var end = $(this).parent().parent().parent().find('.post_comments').attr('end')

        $.ajax({
            url: '/get_comments',
            data: JSON.stringify({'post_id': parent, 'start': start, 'end': end}, null, '\t'),
            type: 'POST',
            contentType: 'application/json;charset=UTF-8',
            success: function(response) {
                console.log(response.status);
                console.log(response.comments_list);
                for (var i = 0; i <= response.comments_list.length - 1; i++) {
                    console.log(response.comments_list[i]);
                    $( '#'+ focusId + " .post_comments" ).prepend( '<div class="comment" id ="'+response.comments_list[i][1]+'"><img src="static/images/'+response.comments_list[i][6][5].split(',')[0]+'" class="comment_img"><p class="comm_username tagbe_hover">'+response.comments_list[i][6][1]+ ' ' + response.comments_list[i][6][2]+'</p><form class="comment_form"><div class="comm_text width100"><div>'+response.comments_list[i][4]+'</div></div></form><div class="dropbtn comm_hover none"><div class="comm_dropdown_div dots_container dropbtn"><div class="dots"></div></div><div class="dropdown-content comm_dropdown"><a class="delete_comm">Delete</a></div></div></div>' );
                }
                if (response.end_of_comm == 'false') {
                    $('#'+ parent + ' .view_more').removeClass('none')
                    $('#'+ parent + ' .view_more .view_more_text:nth-child(1)').removeClass('none')
                }else{
                    $('#'+ parent + ' .view_more .view_more_text:nth-child(1)').addClass('none')
                }
                //<p class="view_more_text none">Hide Additional Comments</p>
                parent_div.find('.post_comments').attr('start', Number(start) + 5)
                parent_div.find('.post_comments').attr('end', Number(end) + 5)

            },
            error: function(error) {
                console.log(error);
            }
        });

        $('html,body').animate({
            scrollTop: $("#"+parent).find('.post_footer').offset().top},
            'slow');
    }else{
        $(this).parent().parent().parent().find('.post_comments .comment').remove()
        $('#'+ parent + ' .comment_btn').toggleClass('fa-comment-o fa-comment')
        $('#'+ parent + ' .post_comments').toggleClass('none')
        $('#'+ parent + ' .hr_none').toggleClass('none')
        $('#'+ parent + ' .comment_form textarea').focus()
        $(this).parent().parent().parent().find('.post_comments').attr('start', '0')
        $(this).parent().parent().parent().find('.post_comments').attr('end', '1')

        $('html,body').animate({
            scrollTop: $("#"+parent).offset().top},
            'fast');
    }



});

function submitData(){
    var href = $('#'+ focusId + ' .my_img').attr('src');
    var name = $('#'+ focusId + " .my_name" ). html()
    var comment_text = $('#'+ focusId + " .my_comment .textarea-size" ). html()

    $.ajax({
        url: '/add_comment',
        data: JSON.stringify({'text': comment_text, 'post_id': focusId, 'date': Date().toLocaleString()}, null, '\t'),
        type: 'POST',
        contentType: 'application/json;charset=UTF-8',
        success: function(response) {
            console.log(response.status, $( '#'+ focusId + " .post_comments .comment" ).last());
            if ($( '#'+ focusId + " .post_comments .comment" ).length>0) {
              $( '#'+ focusId + " .post_comments .comment" ).last().after( '<div class="comment" id ="'+response.comm_id+'"><img src="'+href+'" class="comment_img"><p class="comm_username tagbe_hover">'+name+'</p><form class="comment_form"><div class="comm_text width100"><div>'+comment_text+'</div></div></form><div class="dropbtn comm_hover none"><div class="comm_dropdown_div dots_container dropbtn"><div class="dots"></div></div><div class="dropdown-content comm_dropdown"><a class="delete_comm">Delete</a></div></div></div>' );
            }else{ //if there are no comments, it should be pasted anyway
                $( '#'+ focusId + " .post_comments" ).prepend( '<div class="comment" id ="'+response.comm_id+'"><img src="'+href+'" class="comment_img"><p class="comm_username tagbe_hover">'+name+'</p><form class="comment_form"><div class="comm_text width100"><div>'+comment_text+'</div></div></form><div class="dropbtn comm_hover none"><div class="comm_dropdown_div dots_container dropbtn"><div class="dots"></div></div><div class="dropdown-content comm_dropdown"><a class="delete_comm">Delete</a></div></div></div>' );
            }
            $( '#'+ focusId + ' textarea').val('')

            clear();
            input.addEventListener('input', clear);

            num = Number($('#'+ focusId +' .comments_quantity').html()) + 1
            $('#'+ focusId + ' .comments_quantity').html(num)


        },
        error: function(error) {
            console.log(error);
        }
    });




}

</script>

<script>

// input auto resi
function onReady(f) {
    "complete" === document.readyState
        ? f() : setTimeout(onReady, 10, f);
}

onReady(function() {
    [].forEach.call(
        document.querySelectorAll("input[type='text'].autoresize"),
        registerInput
    );
});
function registerInput(el) {
    el.size = 1;
    var style = el.currentStyle || window.getComputedStyle(el),
        borderBox = style.boxSizing === "border-box",
        boxSizing = borderBox
            ? parseInt(style.borderRightWidth, 10) +
                parseInt(style.borderLeftWidth, 10)
            : 0;
    if ("onpropertychange" in el) {
         // IE
         el.onpropertychange = adjust;
    } else if ("oninput" in el) {
         el.oninput = adjust;
    }
    adjust();

    function adjust() {

        // reset to smaller size (for if text deleted)
        el.style.width = "";

        // getting the scrollWidth should trigger a reflow
        // and give you what the width would be in px if
        // original style, less any box-sizing
        var newWidth = el.scrollWidth + boxSizing;

        // so let's set this to the new width!
        el.style.width = newWidth + "px";
    }
}

$(document).on('click', 'div',  function(e){});
$(document).on('click', 'img',  function(e){});
$(document).on('click', 'button',  function(e){});
</script>


<script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>



</body>
{% endblock%}

